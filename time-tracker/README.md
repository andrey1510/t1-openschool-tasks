__README__
==========

Данное приложение предназначено для сбора и анализа статистики о времени работы синхронных и асинхронных методов.
Использованный стек: Java SE 17, Spring Boot 3.3.0, Spring AOP, JPA, Maven, Lombok, REST-архитектура, Swagger, PostgreSQL.

Установка и запуск:
-----------------------------------



Склонируйте репозиторий, после чего:

**Вариант 1: Запуск в IDE**

Нужно создать базу PostgreSQL для чего надо:

1) запустить сервис **db** из **docker-compose.yml** (должен быть установлен Docker), или,
2) создать в установленном на устройство PostgreSQL базу данных со следующими параметрами:


После создания базы запустить исходный код приложения в IDE.

**Вариант 2: установка в Docker-контейнер**

Должен быть установлен Docker. Запустите файл **docker-compose.yml** в IDE, или в директории ```t1-openschool-tasks\time-tracker``` склонированного репозитория откройте командную строку и выполните команды:

```docker-compose build```

```docker-compose up -d```

В результате будут созданы контейнеры с приложением и базой банных.

**Вариант 3: установка в jar-файл**

Создайте базу данных PostgreSQL как указано выше.

На устройстве должна быть установлена Java. В директории ```t1-openschool-tasks\time-tracker``` склонированного репозитория откройте GitBash и выполните команду:

```./mvnw clean package```

В директории ```t1-openschool-tasks\time-tracker\target``` появится jar файл. Откройте GitBash в этой директории и выполните команду для запуска приложения:

```java -jar [имя jar файла]```

Пример:

```java -jar tim-tracker-1.0.0-SNAPSHOT.jar```

Работа с приложением:
---------------------------------------

После запуска приложение будет доступно по адресу: http://localhost:8885

Приложение поддерживает Swagger. Получить доступ к Swagger UI можно по адресу:  http://localhost:8885/swagger-ui.html.

Документация содержится в Swagger.

Функционал приложения:
------------------------------------------

Приложение синхронно и асинхронно собирает статистику о времени работы своих методов, помеченных аннотациями **@TrackTime** и **@TrackAsyncTime**.

### Контроллер TimeTrackingController

Он содержит все методы, с помощью которых осуществляются операции со статистикой времени выполнения методов. Его методы:

**Метод getAllEntries** - принимает запросы GET на:

```http://localhost:8885/api/methods-operations/execution-entries```

Он возвращает JSON с кодом ```200``` и листом залогированных в базе вызовов методов. Каждая запись представляет собой один вызов метода, и содержит следующие элементы:

1. присваиваемый случайным образом UUID записи,
2. сигнатура метода (название и аргументы),
3. класс метода,
4. пакет метода,
5. таймштамп начала работы метода,
6. таймштамп завершения работы метода,
7. продолжительность работы метода в миллисекундах.

В случае, если в базе нет методов, об этом будет выдано сообщение с кодом ```404```.

**Метод getDurationStatistics** - принимает запросы GET на:

```http://localhost:8885/api/methods-operations/statistics```

Он возвращает JSON с кодом ```200``` и листом записей статистики по каждому методу. Каждая запись представляет собой статистику по всем вызовам одного метода, и содержит следующие элементы:

1. сигнатура метода (название и аргументы),
2. класс метода,
3. пакет метода,
4. полное время работы метода (т.е. сумма всех вызов),
5. средняя продолжительность работы метода,
6. самая короткая продолжительность работы метода,
7. самая длинная продолжительность работы метода,
8. стандартное отклонение,
9. количество вызовов метода.

Все временные характеристики (элементы 4 - 8) приводятся в миллисекундах.

Запрос можно делать по группам методов с помощью следующих фильтров:

* *className* фильтрует методы по сокращенному имени класса, например:

```http://localhost:8885/api/methods-operations/statistics?className=SampleServiceOneImpl```

* *packageName* фильтрует методы по полному имени пакета, например:

```http://localhost:8885/api/methods-operations/statistics?packageName=com.timetracker.services.sampleTwo```

Одновременно можно применять только один фильтр. Если будут указаны оба фильтра, работать будет *className*.

Если не указывать фильтры, будут выданы все записи, имеющиеся в базе.

Если поиск будет проводиться по пустой базе, или если по заданному фильтру не будет найдено методов, об этом будет выдано соответствующее сообщение с кодом ```404```.

**Метод deleteAll** - принимает запросы DELETE на:

```http://localhost:8885/api/methods-operations/delete-all-data```

Он очищает базу, удаляя все записи из нее.

### Контроллер SampleMethodsController

В этом контроллере содержатся методы, с помощью которых можно запустить тестовые методы для проверки функционала по сбору статистики. Каждый метод выдаст название запущенного тестового метода/методов, класс и пакет.

**Эндпойнты:**

*Синхронный аспект:*

POST ```http://localhost:8885/api/sample-methods-launcher/sync/fixedtime-method/{{duration}}``` - запустит 1 тестовый метод с аннотацией @TrackTime. Нужно указать желаемую задержку выполнения (в миллисекундах).

POST ```http://localhost:8885/api/sample-methods-launcher/sync/randomtime-methods/{{iterations}}``` - запустит 3 тестовых метода с аннотацией @TrackTime, которые будут работать рандомное время до 1 секунды, нужно указать желаемое количество итераций.

POST ```http://localhost:8885/api/sample-methods-launcher/sync/crashing-method``` - запустит 1 тестовый метод с аннотацией @TrackTime, который завершится с ошибкой через 1 секунду.

*Асинхронный аспект:*

POST ```http://localhost:8885/api/sample-methods-launcher/async/fixedtime-method/{{duration}}``` - запустит 1 тестовый метод, симулирующий асинхронность, с аннотацией @TrackAsyncTime. Нужно указать желаемую задержку выполнения (в миллисекундах).

POST ```http://localhost:8885/api/sample-methods-launcher/async/randomtime-methods/{{iterations}}``` - запустит 2 тестовых метода, симулирующих асинхронность, с аннотацией @TrackAsyncTime, которые будут работать рандомное время от 2 до 3 секунд, нужно указать желаемое количество итераций.
