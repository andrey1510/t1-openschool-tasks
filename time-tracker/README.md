__README__
==========

Данное приложение предназначено для сбора и анализа статистики о времени работы синхронных и асинхронных методов.
Использованный стек: Java SE 17, Spring Boot 3.3.0, Spring AOP, JPA, Maven, Lombok, REST-архитектура, Swagger, PostgreSQL.

Установка и запуск:
-----------------------------------

Для работы с программой необходимо ее установить и запустить (или просто запустить исходный код в IDE), а также установить и запустить базу данных PostgreSQL

*Вариант 1: Docker*

На устройстве должен быть установлен Docker. Склонируйте репозиторий, в директории ```t1-openschool-tasks\time-tracker``` откройте командную строку и выполните команды:

```docker-compose build```

```docker-compose up -d```

В результате будут созданы контейнеры с приложением и базой банных.

*Вариант 2:*

Создайте базу данных PostgreSQL с следующими параметрами:

```yml
    url: jdbc:postgresql://localhost:24242/timebase
    username: user
    password: password
```

На устройстве должна быть установлена Java. Склонируйте репозиторий, в директории ```t1-openschool-tasks\time-tracker```
откройте GitBash и выполните команду:

```./mvnw clean package```

В директории ```t1-openschool-tasks\time-tracker\target``` появится jar файл. Откройте GitBash в этой директории и выполните команду для запуска приложения (укажите свое имя jar файла):

```java -jar [имя jar файла]```

Работа с приложением:
---------------------------------------

После запуска приложение будет доступно по адресу: http://localhost:8885

Приложение поддерживает Swagger. Получить доступ к Swagger UI можно по адресу:  http://localhost:8885/swagger-ui.html.

Функционал приложения:
------------------------------------------

Приложение синхронно и асинхронно собирает статистику о времени работы своих методов, помеченных аннотациями **@TrackTime** и **@TrackAsyncTime**.

#### Контроллер TimeTrackingController

Он содержит все методы, с помощью которых осуществляются операции со статистикой. Его методы:

**Метод getAllEntries** - принимает запросы GET на:

```http://localhost:8885/api/methods-operations/execution-entries```

Он возвращает JSON с кодом ```200``` и листом залогированных в базе вызовов методов. Каждая запись представляет собой 1 вызов метода, и содержит следующие элементы: (1) присваиваемый случайным образом UUID записи, (2) сигнатура метода (название и аргументы), (3) класс метода, (4) пакет метода, (5) таймштамп начала работы метода, (6) таймштамп завершения работы метода, (7) продолжительность работы метода в миллисекундах.

В случае, если в базе нет методов, об этом будет выдано сообщение с кодом ```404```.

**Метод getDurationStatistics** - принимает запросы GET на:

```http://localhost:8885/api/methods-operations/statistics```

Он возвращает JSON с кодом ```200``` и листом записей статистики по каждому методу. Каждая запись представляет собой статистику по всем вызовам 1 методам, и содержит следующие элементы: (1) сигнатура метода (название и аргументы), (2) класс метода, (3) пакет метода, (4) полное время работы метода (т.е. сумма всех вызов), (5) средняя продолжительность работы метода, (6) самая короткая продолжительность работы метода, (7) самая длинная продолжительность работы метода, (8) стандартное отклонение, (9) количество вызовов метода. Все временные характеристики (элементы 4 - 8) приводятся в миллисекундах.

Запрос можно делать по группам методом с помощью следующих фильтров:

*className* фильтрует методы по сокращенному имени класса, например:

```http://localhost:8885/api/methods-operations/statistics?className=SampleServiceOneImpl```

*packageName* фильтрует по полному имени пакета, например:

```http://localhost:8885/api/methods-operations/statistics?packageName=com.timetracker.services.sampleTwo```

Одновременно можно применять только один фильтр. Если будут указаны оба фильтра, приоритет будет иметь *className*.

Если не указывать фильтры, будут выданы все записи, имеющиеся в базе.

Если поиск будет проводиться по пустой базе, или если по заданному фильтру не будет найдено методов, об этом будет выдано соответствующее сообщение с кодом ```404```.

**Метод deleteAll** - принимает запросы DELETE на:

```http://localhost:8885/api/methods-operations/delete-all-data```

Он очищает базу, удаляя все записи из нее.

#### Контроллер SampleMethodsController

В этом контроллере содержатся методы, с помощью которых можно запустить тестовые методы для проверки функционала по сбору статистики. Каждый метод выдаст название запущенного тестового метода/методов, его класс и пакет.

Эндпойнты:

POST ```http://localhost:8885/api/sample-methods-launcher/sync/fixedtime-method/{{duration}}``` - запустит 1 тестовый метод с аннотацией @TrackTime. Нужно указать желаемую задержку выполнения (в миллисекундах).

POST ```http://localhost:8885/api/sample-methods-launcher/sync/randomtime-methods/{{iterations}}``` - запустит 3 тестовых метода с аннотацией @TrackTime, которые будут работать рандомное время до 1 секунды, нужно указать желаемое количество итераций.

POST ```http://localhost:8885/api/sample-methods-launcher/sync/crashing-method``` - запустит 1 тестовый метод с аннотацией @TrackTime, который завершится с ошибкой через 1 секунду.

POST ```http://localhost:8885/api/sample-methods-launcher/async/fixedtime-method/{{duration}}``` - запустит 1 тестовый метод, симулирующий асинхронность, с аннотацией @TrackAsyncTime. Нужно указать желаемую задержку выполнения (в миллисекундах).

POST ```http://localhost:8885/api/sample-methods-launcher/async/randomtime-methods/{{iterations}}``` - запустит 2 тестовых метода, симулирующих асинхронность, с аннотацией @TrackAsyncTime, которые будут работать рандомное время от 2 до 3 секунд, нужно указать желаемое количество итераций.
